# 第四章：字典——Python 的超级“花名册”

嘿，老铁们！前面咱们把列表、元组、字符串这几个“数据容器”都盘明白了，是不是感觉 Python 越来越顺手了？

别急，今天咱们要解锁一个更牛掰、更灵活的家伙——**<font color='red'>字典 (Dictionary)</font>**！

这玩意儿，你可以把它想象成一本 **<font color='blue'>超级智能的花名册</font>** 或者 **<font color='blue'>现实生活中的字典</font>**。

不像列表那样按顺序排号（0, 1, 2...），字典是靠 **<font color='green'>“名字”（键 Key）</font>** 来找对应的 **<font color='green'>“信息”（值 Value）</font>** 的。

比如，你想查“钢铁侠”的信息，直接喊“钢铁侠”，字典就能告诉你他的能力、装备等等，是不是超方便？

准备好了吗？坐稳扶好，咱们一起探索字典的奥秘！

## 字典是啥？怎么“造”一个出来？

简单说，字典就是一堆 **<font color='purple'>“键值对” (Key-Value Pair)</font>** 的集合，用 **<font color='red'>花括号 `{}`</font>** 包起来。

每个键值对就像花名册里的一条记录：“姓名”（键）对应“电话号码”（值）。

键和值之间用 **<font color='orange'>冒号 `:`</font>** 分隔，不同的键值对之间用 **<font color='orange'>逗号 `,`</font>** 分隔。

```python
# 创建一个空字典
empty_dict = {}

# 创建一个包含信息的字典
student = {
    'name': '小明',
    'age': 18,
    'major': '计算机科学',
    'is_graduated': False
}

print(student)
print(empty_dict)
```

**<font color='red'>重点来了：</font>**

*   **键 (Key)** 必须是 **<font color='blue'>唯一的</font>**、**<font color='blue'>不可变的</font>** 数据类型。最常用的是 **字符串** 和 **数字**。列表、字典这种可变的家伙不能当键！
*   **值 (Value)** 可以是 **<font color='green'>任何</font>** Python 数据类型，数字、字符串、列表、元组，甚至另一个字典都行！

### 用 `dict()` 函数创建字典

除了直接用花括号，还可以用 `dict()` 函数来创建字典，有时候更方便：

```python
# 方式一：传入键值对元组组成的列表或元组
info1 = dict([('name', '小红'), ('age', 20)])
print(info1) # 输出 {'name': '小红', 'age': 20}

# 方式二：使用关键字参数 (键必须是合法的变量名)
info2 = dict(name='小刚', age=22, city='北京')
print(info2) # 输出 {'name': '小刚', 'age': 22, 'city': '北京'}

# 方式三：从一个已有的映射对象创建 (比如另一个字典)
old_dict = {'a': 1, 'b': 2}
new_dict = dict(old_dict)
print(new_dict) # 输出 {'a': 1, 'b': 2}
```

**<font color='purple'>`dict()` 函数提供了多种创建字典的姿势，按需选择！</font>**

## 字典的基本操作 - 增删改查样样行

字典最常用的就是对里面的数据进行增删改查。

### 查：访问字典里的值

想获取某个键对应的值？直接用 **<font color='red'>方括号 `[]`</font>** 加上 **<font color='red'>键</font>** 就行了！

```python
student = {'name': '小明', 'age': 18, 'major': '计算机科学'}

print(student['name'])  # 输出 '小明'
print(student['age'])   # 输出 18

# 如果访问一个不存在的键，会直接报错！KeyError
# print(student['score']) # 这行会报错
```

**<font color='orange'>注意：</font>** 如果你不确定某个键在不在字典里，直接用 `[]` 访问可能会翻车（报错）。后面会讲更安全的访问方法 `get()`。

### 增/改：添加或修改键值对

字典是 **<font color='blue'>可变的 (Mutable)</font>**，可以随时添加新的键值对，或者修改已有的值。

操作方法很简单，还是用 **<font color='red'>方括号 `[]`</font>**：

*   如果键 **<font color='green'>不存在</font>**，就是 **<font color='green'>添加</font>** 新的键值对。
*   如果键 **<font color='green'>已存在</font>**，就是 **<font color='green'>修改</font>** 该键对应的值。

```python
student = {'name': '小明', 'age': 18}

# 添加新的键值对
student['major'] = '物理学' # 添加专业信息
student['city'] = '上海'   # 添加城市信息
print(student) # 输出 {'name': '小明', 'age': 18, 'major': '物理学', 'city': '上海'}

# 修改已有的值
student['age'] = 19 # 年龄长了一岁
print(student) # 输出 {'name': '小明', 'age': 19, 'major': '物理学', 'city': '上海'}
```

**<font color='purple'>增改操作，一个 `[]` 搞定，是不是很方便？</font>**

### 删：删除字典元素

想把某个键值对从字典里踢出去？有几种方法：

1.  **`del` 语句**：简单粗暴，直接删除指定的键值对。如果键不存在，也会报错 `KeyError`。

    ```python
    student = {'name': '小明', 'age': 19, 'major': '物理学'}
    del student['major'] # 删除专业信息
    print(student) # 输出 {'name': '小明', 'age': 19}

    # del student['score'] # 删除不存在的键，报错！
    ```

2.  **`pop(key[, default])` 方法**：删除指定 `key` 的键值对，并 **<font color='red'>返回</font>** 被删除的 **<font color='red'>值</font>**。如果 `key` 不存在，会报错。但你可以提供一个 `default` 参数，这样如果 `key` 不存在，就返回 `default` 值，不报错。

    ```python
    student = {'name': '小明', 'age': 19, 'city': '上海'}

    removed_age = student.pop('age') # 删除 age 并返回值
    print(f"删除了年龄：{removed_age}") # 输出 删除了年龄：19
    print(student) # 输出 {'name': '小明', 'city': '上海'}

    # 尝试删除不存在的 score，提供默认值
    removed_score = student.pop('score', 'N/A')
    print(f"删除的分数：{removed_score}") # 输出 删除的分数：N/A
    print(student) # 字典没变 {'name': '小明', 'city': '上海'}

    # 不提供默认值，删除不存在的键，报错！
    # student.pop('grade')
    ```

3.  **`popitem()` 方法**：随机（在 Python 3.7+ 中是删除 **<font color='red'>最后插入</font>** 的）删除一个键值对，并以 **<font color='red'>元组 `(key, value)`</font>** 的形式返回它。如果字典为空，会报错 `KeyError`。

    ```python
    student = {'name': '小明', 'city': '上海'}
    last_item = student.popitem()
    print(f"删除了最后一项：{last_item}") # 输出 删除了最后一项：('city', '上海')
    print(student) # 输出 {'name': '小明'}

    student.popitem() # 再删一项
    print(student) # 输出 {}

    # student.popitem() # 对空字典操作，报错！
    ```

4.  **`clear()` 方法**：清空整个字典，变成一个空字典 `{}`。（后面方法部分会细讲）

**<font color='green'>删除操作，`del` 最直接，`pop` 能拿回值，`popitem` 删末尾，`clear` 全清空！</font>**

### 字典键的特性回顾

再次强调，字典的 **<font color='red'>键 (Key)</font>** 非常重要，它有两大特性：

1.  **<font color='blue'>唯一性</font>**：一个字典里，键不能重复。如果你尝试用一个已存在的键去添加新的值，实际上会覆盖掉原来的值。

    ```python
    d = {'a': 1, 'b': 2}
    d['a'] = 100 # 键 'a' 已存在，覆盖原来的值
    print(d) # 输出 {'a': 100, 'b': 2}
    ```

2.  **<font color='blue'>不可变性</font>**：键必须是不可变的数据类型，比如数字、字符串、元组（如果元组里只包含不可变元素）。列表、字典、集合这些可变的家伙不能当键。

    ```python
    # 正确的键
    valid_dict = {
        1: 'one',
        'two': 2,
        (1, 2): 'a tuple key'
    }

    # 错误的键 (列表是可变的)
    # invalid_dict = { [1, 2]: 'a list key' } # TypeError: unhashable type: 'list'
    ```

**<font color='orange'>记住键的这两个特性，避免踩坑！</font>**

### `len()` 函数 - 字典里有多少“家当”？

想知道字典里有多少个键值对？用 `len()` 函数。

```python
student = {'name': '小明', 'age': 19, 'major': '物理学'}
print(len(student)) # 输出 3

empty_dict = {}
print(len(empty_dict)) # 输出 0
```

**<font color='green'>`len()` 函数同样适用于字典，告诉你键值对的数量。</font>**

### `type()` 函数 - 确认下“身份”

用 `type()` 函数可以查看一个变量是不是字典类型。

```python
my_dict = {'a': 1}
print(type(my_dict)) # 输出 <class 'dict'>
```

### 字典的格式化字符串

想把字典里的值优雅地塞进字符串里？f-string 同样给力！

```python
student = {'name': '小刚', 'score': 95.5}

print(f"学生姓名：{student['name']}")
print(f"他的分数是：{student['score']}")

# 也可以用 .format()，但稍微麻烦点
print("学生姓名：{s[name]}，分数：{s[score]}".format(s=student))
```

**<font color='red'>f-string 操作字典，依然 YYDS！</font>**

### 字典和列表的区别 - 划重点！

字典和列表都是 Python 里常用的容器，但它们有本质区别：

| 特性       | 列表 (List)                     | 字典 (Dictionary)                 |
| :--------- | :------------------------------ | :-------------------------------- |
| **结构**   | 有序的元素集合                  | 无序的键值对 (Key-Value) 集合   |
| **访问方式** | 通过 **<font color='blue'>索引 (0, 1, 2...)</font>** 访问 | 通过 **<font color='red'>键 (Key)</font>** 访问         |
| **元素**   | 任何数据类型                    | 键值对，键必须唯一且不可变        |
| **顺序**   | **<font color='green'>保持插入顺序</font>**        | Python 3.7+ **<font color='green'>保持插入顺序</font>** (之前版本无序) |
| **用途**   | 存储一系列有序的数据            | 存储关联信息，快速查找          |
| **表示**   | 方括号 `[]`                     | 花括号 `{}`                       |

**<font color='purple'>简单记：列表靠“排队号”，字典靠“名字”！</font>**

## 字典方法 - 自带的“武功秘籍”

字典也有一堆内置的方法，让操作更方便高效。

### `clear()` - 一键清空

把字典里的所有键值对都删掉，变成空字典。

```python
student = {'name': '小明', 'age': 19}
student.clear()
print(student) # 输出 {}
```

**<font color='orange'>想彻底清空字典？用 `clear()`。</font>**

### `copy()` - 复制一个副本

创建一个字典的 **<font color='red'>浅拷贝 (Shallow Copy)</font>**。

啥叫浅拷贝？就是复制了字典本身和里面的键值对引用。如果值是不可变类型（数字、字符串、元组），没啥影响。但如果值是 **<font color='blue'>可变类型</font>**（比如列表），那么原字典和新字典里的这个列表 **<font color='blue'>指向的是同一个内存地址</font>**！改一个，另一个也会跟着变！

```python
original = {'name': '小明', 'scores': [90, 85, 92]}

# 浅拷贝
copied = original.copy()

print(f"Original: {original}")
print(f"Copied:   {copied}")

# 修改 copied 中的不可变值 (name)
copied['name'] = '小红'
print("--- 修改 copied name ---")
print(f"Original: {original}") # 不受影响
print(f"Copied:   {copied}")

# 修改 copied 中的可变值 (scores 列表)
copied['scores'].append(88)
print("--- 修改 copied scores ---")
print(f"Original: {original}") # !!! 也跟着变了 !!!
print(f"Copied:   {copied}")
```

**<font color='red'>`copy()` 是浅拷贝！处理嵌套的可变对象时要小心！</font>** 如果想彻底复制（深拷贝），需要用到 `copy` 模块的 `deepcopy()` 函数。

### `fromkeys(seq[, value])` - 批量创建键

这是一个 **<font color='green'>类方法</font>** (通过 `dict.fromkeys()` 调用)，它可以根据一个序列 `seq` (比如列表、元组、字符串) 里的元素作为键，创建一个新字典。

所有这些新键对应的值，默认是 `None`，你也可以指定一个 `value`。

```python
keys = ['name', 'age', 'city']

# 使用默认值 None
default_dict = dict.fromkeys(keys)
print(default_dict) # 输出 {'name': None, 'age': None, 'city': None}

# 指定默认值
initial_dict = dict.fromkeys(keys, '未知')
print(initial_dict) # 输出 {'name': '未知', 'age': '未知', 'city': '未知'}

# 也可以用字符串作为序列
char_dict = dict.fromkeys('abc', 0)
print(char_dict) # 输出 {'a': 0, 'b': 0, 'c': 0}
```

**<font color='blue'>想快速创建一堆键，值都一样的字典？`fromkeys` 帮你搞定！</font>**

### `get(key[, default])` - 安全地获取值

这个方法是访问字典值的 **<font color='red'>安全姿势</font>**！

它尝试获取 `key` 对应的值：

*   如果 `key` **<font color='green'>存在</font>**，就返回对应的值。
*   如果 `key` **<font color='green'>不存在</font>**，它 **<font color='red'>不会报错</font>**！而是返回 `None` (默认)，或者返回你指定的 `default` 值。

```python
student = {'name': '小明', 'age': 19}

# 获取存在的键
print(student.get('name')) # 输出 '小明'

# 获取不存在的键 (默认返回 None)
print(student.get('major')) # 输出 None

# 获取不存在的键，指定默认值
print(student.get('major', '未指定')) # 输出 '未指定'

# 对比下方括号访问不存在的键
# print(student['major']) # KeyError: 'major'
```

**<font color='purple'>强烈推荐用 `get()` 来访问字典值，避免 `KeyError` 报错！</font>**

### `key in dict` - 判断键是否存在

想知道某个键在不在字典里？用 `in` 关键字，返回 `True` 或 `False`。

```python
student = {'name': '小明', 'age': 19}

print('name' in student)  # 输出 True
print('major' in student) # 输出 False
print('age' not in student) # 输出 False
```

**<font color='green'>`in` 操作符是判断键是否存在的标准方法！</font>**

### `items()` - 获取所有键值对

返回一个包含所有 **<font color='red'>(键, 值)</font>** 元组的 **<font color='red'>视图对象 (View Object)</font>**。

这个视图对象可以像列表一样被迭代，常用于 `for` 循环遍历字典。

```python
student = {'name': '小明', 'age': 19, 'major': '物理学'}

items_view = student.items()
print(items_view) # 输出 dict_items([('name', '小明'), ('age', 19), ('major', '物理学')])

# 遍历所有键值对
for key, value in student.items():
    print(f"键：{key}，值：{value}")
```

**<font color='blue'>想同时拿到键和值？用 `items()` 遍历！</font>**

### `keys()` - 获取所有键

返回一个包含所有 **<font color='red'>键</font>** 的 **<font color='red'>视图对象</font>**。

```python
student = {'name': '小明', 'age': 19, 'major': '物理学'}

keys_view = student.keys()
print(keys_view) # 输出 dict_keys(['name', 'age', 'major'])

# 遍历所有键
for key in student.keys():
    print(f"键：{key}")

# 其实直接遍历字典默认就是遍历键
# for key in student:
#     print(f"键：{key}")
```

**<font color='orange'>想单独获取所有键？用 `keys()`。</font>** (直接 `for key in dictionary:` 效果一样)

### `values()` - 获取所有值

返回一个包含所有 **<font color='red'>值</font>** 的 **<font color='red'>视图对象</font>**。

```python
student = {'name': '小明', 'age': 19, 'major': '物理学'}

values_view = student.values()
print(values_view) # 输出 dict_values(['小明', 19, '物理学'])

# 遍历所有值
for value in student.values():
    print(f"值：{value}")
```

**<font color='purple'>想单独获取所有值？用 `values()`。</font>**

**<font color='red'>注意：</font>** `items()`, `keys()`, `values()` 返回的都是 **<font color='red'>视图对象</font>**，不是列表！它们会 **<font color='blue'>动态反映</font>** 字典的变化。如果你需要一个固定的列表，可以用 `list()` 转换一下，比如 `list(student.keys())`。

### `setdefault(key[, default])` - 获取键值（不存在则设置）

这个方法有点像 `get()`，但更强大一点。

它尝试获取 `key` 的值：

*   如果 `key` **<font color='green'>存在</font>**，就返回它的值。
*   如果 `key` **<font color='green'>不存在</font>**，它会 **<font color='red'>先在字典里添加</font>** 这个 `key`，并把值设为 `default` (如果没提供 `default`，默认为 `None`)，然后 **<font color='red'>再返回</font>** 这个 `default` 值。

```python
student = {'name': '小明'}

# 获取存在的键 'name'
name = student.setdefault('name', '未知')
print(f"姓名：{name}") # 输出 姓名：小明
print(student) # 字典没变 {'name': '小明'}

# 获取不存在的键 'age'，设置默认值 18
age = student.setdefault('age', 18)
print(f"年龄：{age}") # 输出 年龄：18
print(student) # !!! 字典被修改了 !!! {'name': '小明', 'age': 18}

# 获取不存在的键 'city'，使用默认值 None
city = student.setdefault('city')
print(f"城市：{city}") # 输出 城市：None
print(student) # !!! 字典又被修改了 !!! {'name': '小明', 'age': 18, 'city': None}
```

**<font color='orange'>`setdefault()` 适合那种“如果键不在，就给它设个默认值，然后用这个值”的场景。</font>**

### `update(other_dict)` - 合并字典

用另一个字典 `other_dict` 的键值对来 **<font color='red'>更新</font>** 当前字典。

*   如果 `other_dict` 里的键在当前字典中 **<font color='blue'>不存在</font>**，就 **<font color='blue'>添加</font>** 进去。
*   如果 `other_dict` 里的键在当前字典中 **<font color='blue'>已存在</font>**，就用 `other_dict` 里的值 **<font color='blue'>覆盖</font>** 当前字典的值。

```python
student = {'name': '小明', 'age': 18}
new_info = {'age': 19, 'major': '计算机科学', 'city': '北京'}

student.update(new_info)

print(student)
# 输出 {'name': '小明', 'age': 19, 'major': '计算机科学', 'city': '北京'}
# 'age' 被更新了，'major' 和 'city' 被添加了

# update() 也可以接受键值对序列
student.update([('score', 90), ('name', '小明同学')])
print(student)
# 输出 {'name': '小明同学', 'age': 19, 'major': '计算机科学', 'city': '北京', 'score': 90}

# 也可以用关键字参数
student.update(is_graduated=False, hobby='编程')
print(student)
# 输出 {'name': '小明同学', 'age': 19, 'major': '计算机科学', 'city': '北京', 'score': 90, 'is_graduated': False, 'hobby': '编程'}
```

**<font color='green'>想合并两个字典或者批量更新？`update()` 是你的好帮手！</font>**

## 字典的嵌套 - 套娃模式开启！

字典的值可以是任何类型，当然也包括另一个字典或者列表！这就形成了 **<font color='red'>嵌套</font>**。

这让我们可以构建更复杂的数据结构，比如表示一个班级的学生信息：

```python
# 字典嵌套字典
students = {
    'student_001': {
        'name': 'Alice',
        'age': 20,
        'courses': ['Math', 'Physics']
    },
    'student_002': {
        'name': 'Bob',
        'age': 21,
        'courses': ['Chemistry', 'Biology']
    }
}

# 访问嵌套字典的值
print(students['student_001']['name']) # 输出 Alice
print(students['student_002']['courses']) # 输出 ['Chemistry', 'Biology']

# 访问嵌套列表的值
print(students['student_001']['courses'][0]) # 输出 Math

# 修改嵌套的值
students['student_002']['age'] = 22
students['student_001']['courses'].append('Computer Science')

print(students)
```

**<font color='blue'>字典嵌套，一层一层访问，就像剥洋葱！</font>** 用 `[]` 连续访问就行。

## 字典推导式 - 快速“造”字典的黑科技

还记得列表推导式吗？字典也有类似的 **<font color='red'>字典推导式 (Dictionary Comprehension)</font>**！

它提供了一种简洁、高效的方式来 **<font color='green'>根据已有的可迭代对象创建新的字典</font>**。

语法：`{key_expression: value_expression for item in iterable if condition}`

*   `key_expression`: 生成新字典键的表达式。
*   `value_expression`: 生成新字典值的表达式。
*   `item`: 从 `iterable` 中取出的元素。
*   `iterable`: 可迭代对象（如列表、元组、字符串、字典的 items() 等）。
*   `if condition` (可选): 过滤条件，只有满足条件的 `item` 才会被处理。

```python
# 例子1：创建一个数字及其平方的字典
squares = {x: x**2 for x in range(1, 6)}
print(squares) # 输出 {1: 1, 2: 4, 3: 9, 4: 16, 5: 25}

# 例子2：从列表中筛选偶数及其三次方
even_cubes = {num: num**3 for num in [1, 2, 3, 4, 5, 6] if num % 2 == 0}
print(even_cubes) # 输出 {2: 8, 4: 64, 6: 216}

# 例子3：快速交换字典的键和值 (假设值都是唯一的且不可变)
original_dict = {'a': 1, 'b': 2, 'c': 3}
swapped_dict = {value: key for key, value in original_dict.items()}
print(swapped_dict) # 输出 {1: 'a', 2: 'b', 3: 'c'}

# 例子4：根据条件创建字典
names = ['Alice', 'Bob', 'Charlie']
name_lengths = {name: len(name) for name in names if len(name) > 3}
print(name_lengths) # 输出 {'Alice': 5, 'Charlie': 7}
```

**<font color='purple'>字典推导式，代码更简洁，逼格更高！</font>** 是 Pythonic 写法的重要体现。

## 字典在实际项目中的应用案例 - “花名册”大显身手

字典这么灵活，在实际开发中用处可大了去了！

### 案例一：配置文件解析

很多软件的配置信息（比如数据库地址、端口、用户名密码等）会存放在一个文件里（比如 INI, JSON, YAML 格式）。程序读取这些文件后，通常会把配置项解析成一个字典来使用，方便通过键名获取配置值。

```python
# 模拟从配置文件读取的字典
config = {
    'database': {
        'host': 'localhost',
        'port': 3306,
        'user': 'admin'
    },
    'server': {
        'ip': '192.168.1.100',
        'workers': 4
    }
}

# 使用配置
db_host = config['database']['host']
server_workers = config.get('server', {}).get('workers', 1) # 安全获取

print(f"数据库主机：{db_host}")
print(f"服务器工作进程数：{server_workers}")
```

**<font color='orange'>用字典存配置，清晰明了，易于管理！</font>**

### 案例二：数据统计与计数

想统计一段文本里每个单词出现的次数？或者统计投票结果？字典是绝佳的选择！用单词（或选项）作为键，出现次数作为值。

```python
text = "this is a sample text this text has sample words"
word_counts = {}

for word in text.split():
    # get(word, 0) 获取当前单词计数，如果不存在则为 0
    word_counts[word] = word_counts.get(word, 0) + 1

print(word_counts)
# 输出 {'this': 2, 'is': 1, 'a': 1, 'sample': 2, 'text': 2, 'has': 1, 'words': 1}

# 也可以用 setdefault
word_counts_v2 = {}
for word in text.split():
    word_counts_v2.setdefault(word, 0) # 如果 word 不在，设为 0
    word_counts_v2[word] += 1
print(word_counts_v2)
```

**<font color='green'>做计数统计，字典是天然的利器！</font>** (Python 的 `collections.Counter` 类是更专业的计数工具)

### 案例三：表示对象属性

在没有专门定义类的情况下，可以用字典来临时表示一个对象的各种属性。

```python
# 用字典表示一本书的信息
book = {
    'title': 'Python 从入门到放弃',
    'author': '某大佬',
    'pages': 300,
    'isbn': '978-1234567890'
}

print(f"书名：{book['title']}")
print(f"作者：{book.get('author', '佚名')}")
```

**<font color='blue'>用字典模拟对象，简单快捷！</font>**

---

呼~ 字典这本“花名册”的内容可真不少！

从创建、增删改查，到各种实用的方法，再到嵌套和推导式，最后看了看它的实际应用。

**<font color='red'>核心记住：字典是键值对的集合，通过键来快速查找值，键必须唯一且不可变！</font>**

掌握了字典，你处理各种关联数据的能力就又上了一个大台阶！

下一章，咱们要去探索另一种集合类型——**集合 (Set)**，敬请期待！