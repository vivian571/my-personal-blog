# 第6节：全栈框架_模板层

## 来源

Django的模板系统是一个强大的工具，它允许我们以一种优雅的方式将Python代码和HTML标记分离。模板系统的设计目标是实现表现层和业务逻辑的分离，使得前端开发者可以专注于页面设计，而后端开发者可以专注于业务逻辑的实现。通过模板系统，我们可以创建动态的HTML页面，重用页面组件，并实现一致的页面布局。

## 定义

### 模板语法

模板使用特殊的语法来嵌入动态内容：

```html
<!-- 变量 -->
<h1>{{ page_title }}</h1>
<p>Welcome, {{ user.username }}!</p>

<!-- 过滤器 -->
<p>Published: {{ post.date|date:"F j, Y" }}</p>
<div>{{ content|safe|linebreaks }}</div>

<!-- 标签 -->
{% if user.is_authenticated %}
    <p>Welcome back!</p>
{% else %}
    <p>Please log in.</p>
{% endif %}

{% for item in items %}
    <li>{{ item.name }}</li>
{% empty %}
    <li>No items found.</li>
{% endfor %}
```

### 模板继承

模板继承允许创建一个基础模板，然后在其他模板中扩展它：

```html
<!-- base.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}My Site{% endblock %}</title>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <header>{% block header %}{% endblock %}</header>
    <main>{% block content %}{% endblock %}</main>
    <footer>{% block footer %}{% endblock %}</footer>
    {% block extra_js %}{% endblock %}
</body>
</html>

<!-- page.html -->
{% extends "base.html" %}

{% block title %}Welcome - {{ block.super }}{% endblock %}

{% block content %}
    <h1>Welcome to our site!</h1>
    <p>{{ welcome_message }}</p>
{% endblock %}
```

### 自定义模板标签和过滤器

```python
# templatetags/custom_tags.py
from django import template
from django.template.defaultfilters import stringfilter

register = template.Library()

@register.simple_tag
def get_current_time(format_string):
    from datetime import datetime
    return datetime.now().strftime(format_string)

@register.filter
@stringfilter
def upper_and_reverse(value):
    return value.upper()[::-1]
```

## 案例

### 响应式导航栏

```html
{% load static %}

<!-- components/navbar.html -->
<nav class="navbar">
    <div class="navbar-brand">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/logo.png' %}" alt="Logo">
        </a>
        <button class="navbar-toggle" data-target="#main-nav">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
    
    <div id="main-nav" class="navbar-menu">
        <div class="navbar-start">
            <a href="{% url 'home' %}" class="navbar-item">首页</a>
            <a href="{% url 'blog:list' %}" class="navbar-item">博客</a>
            <a href="{% url 'about' %}" class="navbar-item">关于</a>
        </div>
        
        <div class="navbar-end">
            {% if user.is_authenticated %}
                <div class="navbar-item has-dropdown">
                    <a class="navbar-link">{{ user.username }}</a>
                    <div class="navbar-dropdown">
                        <a href="{% url 'profile' %}" class="navbar-item">个人资料</a>
                        <a href="{% url 'logout' %}" class="navbar-item">退出</a>
                    </div>
                </div>
            {% else %}
                <div class="navbar-item">
                    <a href="{% url 'login' %}" class="button is-light">登录</a>
                    <a href="{% url 'register' %}" class="button is-primary">注册</a>
                </div>
            {% endif %}
        </div>
    </div>
</nav>
```

### 分页模板

```html
<!-- components/pagination.html -->
{% if is_paginated %}
<nav class="pagination" role="navigation" aria-label="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" 
           class="pagination-previous">上一页</a>
    {% endif %}
    
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" 
           class="pagination-next">下一页</a>
    {% endif %}
    
    <ul class="pagination-list">
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li>
                    <a class="pagination-link is-current" 
                       aria-current="page">{{ num }}</a>
                </li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li>
                    <a href="?page={{ num }}" 
                       class="pagination-link">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}
    </ul>
</nav>
{% endif %}
```

### 表单模板

```html
<!-- forms/contact.html -->
<form method="post" class="form">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
        <div class="message is-danger">
            <div class="message-body">
                {{ form.non_field_errors }}
            </div>
        </div>
    {% endif %}
    
    {% for field in form %}
        <div class="field">
            <label class="label">{{ field.label }}</label>
            <div class="control">
                {{ field }}
                {% if field.help_text %}
                    <p class="help">{{ field.help_text }}</p>
                {% endif %}
                {% if field.errors %}
                    <p class="help is-danger">{{ field.errors|join:', ' }}</p>
                {% endif %}
            </div>
        </div>
    {% endfor %}
    
    <div class="field">
        <div class="control">
            <button type="submit" class="button is-primary">提交</button>
        </div>
    </div>
</form>
```

## 总结

1. **模板系统实现了表现层和业务逻辑的分离**，使得前后端开发可以独立进行，提高开发效率。

2. **模板语法简洁而强大**，提供了变量、过滤器、标签等功能，可以灵活地处理和展示数据。

3. **模板继承机制促进了代码复用**，通过基础模板和块标签可以实现页面结构的统一管理。

4. **自定义标签和过滤器扩展了模板系统的功能**，可以根据需求添加特定的处理逻辑。

5. **组件化开发提高了代码的可维护性**，常用的UI组件可以被多个页面共享和复用。

6. **模板中的条件和循环语句**使得页面可以根据数据动态生成内容。

7. **安全特性内置**，如CSRF保护和HTML转义，有效防止常见的Web安全问题。

8. **静态文件管理集成**，便于处理CSS、JavaScript和图片等静态资源。